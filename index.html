<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>POI MAP EDITOR</title>
    <link rel="stylesheet" href="./style.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
      integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
      crossorigin=""
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css"
    />
    <link rel="stylesheet" href="./button.css" />
  </head>
  <body>
    <main>
      <h1>POI MAP EDITOR</h1>
      <span style="color:red">現在検証が不十分な状態です。何卒ご了承ください。</span>
      <section>

      </section>

      <section>
        <div id="wrapper-editor">
          <div id="wrapper-map" class="container-box">
            <div>
              <input type="file" name="" id="gpx-file" accept=".gpx" />
              <button type="button" id="load-gpx-button">読み込む</strong></button>
            </div>
            <div id="map"></div>
          </div>

          <div id="wrapper-markers" class="container-box">
            <div id="wrapper-csv-read">
              <details>
                <summary>csv形式で一括挿入</summary>
                <div>
                  <legend>csvフォーマット</legend>
                  <pre>緯度,経度,POI名</pre>
                  <textarea
                    id="csv-text"
                    cols="30"
                    rows="10"
                    placeholder="35.68148019312498, 139.7671569845131, 東京駅"
                  ></textarea>
                  <br />
                  <button type="button" id="csv-insert-button">挿入</button>
                </div>
              </details>
            </div>
            <form id="marker-form" onsubmit="onExport();return false">
              <div id="wrapper-export">
                <input type="submit" id="export-button" value="出力（ダウンロード）">
              </div>
              <div id="wrapper-marker-table">
                POI一覧表
                <table id="marker-table">
                  <thead>
                    <tr>
                      <th>POI名</th>
                      <th>緯度・経度</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
                <template id="template-marker-table-row-content">
                  <tr class="active" onclick="onMarkerTableRowClick(this)">
                    <td>
                      <label for="poi-title" class="marker-index"> POI名 </label>
                      <input
                        type="text"
                        name="poi-title"
                        class="title"
                        required
                      />
                    </td>
                    <td>
                      <!-- <input
                        type="string"
                        name="latlng"
                        class="latlng"
                        onchange="onLatLngEdited(this)"
                      /> -->
                      <div>
                        <label for="lat">緯度</label>
                        <input
                          type="text"
                          name="lat"
                          class="lat"
                          pattern="\d{1,3}\.\d{2,}"
                          required
                          onchange="onChangeLat(this)"
                        />
                      </div>
                      <div>
                        <label for="lng">経度</label>
                        <input
                          type="text"
                          name="lng"
                          class="lng"
                          pattern="\d{1,3}\.\d{2,}"
                          required
                          onchange="onChangeLng(this)"
                        />
                      </div>
                    </td>
                    <td>
                      <button
                        class="remove-button"
                        onclick="MarkerTable.removeRow(this)"
                      >
                        ×
                      </button>
                    </td>
                  </tr>
                </template>
              </div>
            </form>
          </div>
        </div>
      </section>

      <section>
        <h2>WHAT IS THIS</h2>
        <p>
          <strong>GPX ファイル</strong>
          （ルート・トラックファイル）を読み込み、<strong>Open Street Map</strong
          >上で、<strong>ウェイポイント</strong>(POI)を設定するWEBアプリです。<br />
          <strong>Ride With GPS</strong
          >等のルートファイルを元に使用することを想定しています。
        </p>
        <p>スマホ向けデザインの適応はしていません。ご了承ください。</p>

        <h2>HOW TO USE</h2>
        <dl id="howtouse">
          <dt>ルートを読み込む</dt>
          <dd>
            ダウンロードした<strong>Ride With GPS</strong>等の<strong>GPXファイル</strong>（トラックファイル）を、マップ上部にある「ファイル選択」から選択し、「読み込む」ボタンを押してください。
          </dd>
          <dt>ＰＯＩの追加</dt>
          <dd>
            <ol>
              <li>
                マップ上をクリック・タップするとPOIが追加されます。
              </li>
              <li>
                出力ボタン上部の<strong>csv形式で一括挿入</strong>から<br>
                【緯度,経度,POI名】のフォーマットのCSVを直接書くことでも追加できます。
              </li>
            </ol>
          </dd>
          <dt>POIの名称を編集する</dt>
          <dd>POI一覧表から「POI名」の欄を編集してください。</dd>
          <dt>gpxファイルを出力・利用する</dt>
          <dd>
            出力（ダウンロードボタン）をクリック・タップすると、<br>
            読み込んだGPXファイルにPOI（ウェイポイント）情報を追加した新たなGPXファイルが
            ダウンロードされます。
            <br>
            （ファイル名：<strong>included_poi_{元のファイル名}</strong>）
            <br />
            ダウンロードしたファイルをデバイスに<strong style="color:red;font-size:1.3rem"><big>USB経由でインストール</big></strong>してください。<br>
            ほとんどの場合、他サービス経由（Garmin Connect等）でインストールしようとしても、POI部分は削除されます。
          </dd>
        </dl>

        <h3>使用したライブラリ等</h3>
        <ul>
          <li>
            <a href="http://www.openstreetmap.org/copyright" target="_blank"
              >OpenStreetMap</a
            >
          </li>
          <li>
            <a href="https://leafletjs.com/" target="_blank"> leaflet.js </a>
          </li>
          <li>
            <a href="https://github.com/mpetazzoni/leaflet-gpx" target="_blank"
              >leaflet-gpx</a
            >
          </li>
          <li>
            <a href="https://github.com/riversun/xml-beautify" target="_blank"
              >xml-beautify</a
            >
          </li>
        </ul>

        <hr />
        <h5>更新履歴</h5>
        <dl>
          <dt>2023/05/03</dt>
          <dd>α版公開</dd>
        </dl>
      </section>
      <footer>
        <a href="https://twitter.com/hsnakimoen" target="_blank">©nakimoen</a>
      </footer>
    </main>

    <script
      src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
      integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
      crossorigin=""
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xml-beautify@1.2.3/dist/XmlBeautify.js"></script>
    <script src="./script.js"></script>
    <script src="./gpx.js"></script>
    <script src="./gpxEditor.js"></script>
  </strongody>
</html>
